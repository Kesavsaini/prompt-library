---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import PromptCard from "../../components/PromptCard.astro";

export async function getStaticPaths() {
	const prompts = await getCollection("prompts");
	const paths = new Set<string>();

	prompts.forEach((p) => {
		const segments = p.id.split("/");
		segments.pop(); // Remove filename
		let currentPath = "";
		segments.forEach((segment) => {
			currentPath = currentPath ? `${currentPath}/${segment}` : segment;
			paths.add(currentPath);
		});
	});

	return Array.from(paths).map((category) => {
		const categoryPath = category + "/";
		const filteredPrompts = prompts.filter((p) =>
			p.id.startsWith(categoryPath),
		);
		return {
			params: { category },
			props: { category, prompts: filteredPrompts },
		};
	});
}

const { category, prompts } = Astro.props;

// Sort by date descending
prompts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout
	title={`${category} Prompts`}
	description={`Browse our collection of ${category} prompts.`}
>
	<div class="mb-12 text-center">
		<h1 class="text-4xl md:text-5xl font-bold mb-4">{category} Prompts</h1>
		<p class="text-xl text-slate-400 max-w-2xl mx-auto">
			Browse our curated selection of prompts for {category}.
		</p>
	</div>

	<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
		{prompts.map((prompt) => <PromptCard prompt={prompt} />)}
	</div>
</Layout>
